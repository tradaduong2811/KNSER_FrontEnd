
//var app = angular.module('RssFeed', [])

var app = angular.module('App', [])

var serviceBase = 'http://localhost:8248/';
//var serviceBase = 'http://knsersbackend.apphb.com/';

app.controller('RssEventController', ['$scope', '$http', RssEventController]);

function RssEventController($scope, $http) {
    $scope.answered = false;
    $scope.title = "loading rss feed...";
    $scope.correctAnswer = false;
    $scope.working = false;

    $http.get(serviceBase + "api/RssFeed/rss").success(function (data, status, headers, config) {
        $scope.options = data;
        $scope.title = "Rss FIT";
    }).error(function (data, status, headers, config) {
        $scope.title = "Oops... something went wrong";
        $scope.working = false;
    });

}


app.controller('LetterController', ['$scope', '$http', LetterController]);

//angularjs controller method
function LetterController($scope, $http) {
    $scope.loading = true;
    $scope.addMode = false;
    $scope.buttonmode = true;
    $scope.enddatemode = false;
    $scope.LetterIdSelected = '1';
    //$scope.data.letterid = null;

    // get all letter
    $http.get(serviceBase + "api/Letter/get").success(function (data, status, headers, config) {
        $scope.letters = data;
        $scope.loading = false;
    })
    .error(function () {
        $scope.error = "An Error has occured while loading posts!";
        $scope.loading = false;
    });

    //by pressing toggleEdit button ng-click in html, this method will be hit
    $scope.toggleEdit = function () {
        this.student.editMode = !this.student.editMode;
    };

    $scope.toggleView = function () {
        this.student.viewMode = !this.student.viewMode;
    }
    $scope.toggleAdd = function () {
        $scope.addMode = !$scope.addMode;
    };

    $scope.changedValue = function (item) {
        if (item.letterId == '2') {
            $scope.enddatemode = true;
        }
        else {
            $scope.enddatemode = false;
        }
        $scope.buttonmode = false;
        $scope.LetterIdSelected = item.letterId;
    }
    // insert letter
    $scope.add = function () {
        $scope.loading = true;
        this.NewRequest.LetterId = $scope.LetterIdSelected;
        //alert(this.NewRequest.LetterId);
        $http.post(serviceBase + 'api/Letter/Create', this.NewRequest)
            .success(function (data) {
                alert("Hoàn tất");
                $scope.addMode = false;
                $scope.letters.push(data);
                $scope.loading = false;
            })
            .error(function (data) {
                $scope.error = "Xảy ra lỗi trong quá trình tạo đơn " + data;
                $scope.loading = false;
                alert("Lỗi");
            });
    };

    ////Delete Student
    //$scope.deleteletter = function () {
    //    $scope.loading = true;
    //    var Id = this.student.StudentId;
    //    $http.delete('http://localhost:2371/api/student/delete/?id=' + Id).success(function (data) {
    //        alert("Deleted Successfully!!");
    //        $.each($scope.students, function (i) {
    //            if ($scope.students[i].StudentId === Id) {
    //                $scope.students.splice(i, 1);
    //                return false;
    //            }
    //        });
    //        $scope.loading = false;
    //    }).error(function (data) {
    //        $scope.error = "An Error has occured while Saving Student! " + data;
    //        $scope.loading = false;

    //    });
    //};


    ////Edit Student
    //$scope.save = function () {
    //    alert("Edit");
    //    $scope.loading = true;
    //    var frien = this.student;
    //    alert(frien);
    //    $http.put('http://localhost:2371/api/StudentApi/' + frien.StudentId, frien).success(function (data) {
    //        alert("Saved Successfully!!");
    //        frien.editMode = false;
    //        $scope.loading = false;
    //    }).error(function (data) {
    //        $scope.error = "An Error has occured while Saving Student! " + data;
    //        $scope.loading = false;
    //    });
    //};
}

//member
app.controller('memberController', function ($scope, $http) {
    $scope.loading = true;
    $scope.addMode = false;

    $http.get(serviceBase + "api/members").success(function (data) {
        $scope.members = data;
        $scope.loading = false;
    })
 .error(function () {
     $scope.error = "Oops!";
     $scope.loading = false;
 });

    $scope.toggleEdit = function () {
        this.member.editMode = !this.member.editMode;
    };

    $scope.toggleAdd = function () {
        $scope.addMode = !$scope.addMode;
    };

});



app.controller('RequestController', ['$scope', '$http', RequestController]);

function RequestController($scope, $http) {
    $scope.loading = true;
    $scope.addMode = false;
    $scope.viewMode = false;
    $scope.disable = false;
    $scope.status = "text-danger";
    $scope.ApprovalStatus = false;
    $scope.name = '';
    
    // get all letter
    $http.get(serviceBase + "api/Requests/Get").success(function (data, status, headers, config) {
        $scope.requests = data;
        $scope.loading = false;
    })
    .error(function () {
        $scope.error = "An Error has occured while loading posts!";
        $scope.loading = false;
    });
    

    // approval 
    $scope.approval = function () {
        $scope.loading = true;
        var frien = this.request;
        frien.approval = true;
        alert(frien);
        $http.put(serviceBase + 'api/Requests/' + frien.requestid, frien).success(function (data) {
            $scope.ApprovalStatus = true;
            frien.editMode = false;
            $scope.loading = false;
        }).error(function (data) {
            $scope.ApprovalStatus = "Xảy ra lỗi trong quá trình duyệt đơn " + data;
            $scope.loading = false;
        });
    };

    // cancel approval
    $scope.cancel = function () {
        $scope.loading = true;
        var frien = this.request;
        frien.approval = false;
        alert(frien);
        $http.put(serviceBase + 'api/Requests/' + frien.requestid, frien).success(function (data) {
            $scope.ApprovalStatus = true;
            frien.editMode = false;
            $scope.loading = false;
        }).error(function (data) {
            $scope.ApprovalStatus = "Xảy ra lỗi trong quá trình duyệt đơn " + data;
            $scope.loading = false;
        });
    };
}